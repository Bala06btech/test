import boto3

def run_logs_insights_query(log_group_name, query_string):
    client = boto3.client('logs')

    response = client.start_query(
        logGroupName=log_group_name,
        startTime=int((datetime.now() - timedelta(hours=1)).timestamp()),
        endTime=int(datetime.now().timestamp()),
        queryString=query_string
    )

    query_id = response['queryId']

    query_results = client.get_query_results(queryId=query_id)

    return query_results

# Example query
log_group_name = '/aws-glue/jobs/output'
query_string = 'fields @timestamp, @message | filter @logStream = \'your_log_stream_name\' | filter @logStreamId = \'your_log_stream_id\' | filter @log = \'your_log_id\''

result = run_logs_insights_query(log_group_name, query_string)
print(result)


# Example query
log_group_name = '/aws-glue/jobs/output'
query_string = 'fields @timestamp, @message | filter @logStream = \'your_log_stream_name\' | filter @logStreamId = \'your_log_stream_id\' | filter @log = \'your_log_id\''

result = run_logs_insights_query(log_group_name, query_string)
print(result)




aws s3api list-object-versions --bucket your-bucket-name --prefix your-folder-path/ --output json --query "Versions[?IsDeleteMarker==true && LastModified<= 'desired-time']"

aws glue list-jobs

aws glue get-job --job-name your-job-name

for job_name in $(aws glue list-jobs --output text --query 'JobNames'); do
    script_location=$(aws glue get-job --job-name $job_name --query 'Job.Command.ScriptLocation' --output text)
    echo "Job Name: $job_name, Script Location: $script_location"
done

@echo off

setlocal enabledelayedexpansion
set "count=0"

for /f "delims=" %%A in ('aws glue list-jobs --output text --query "JobNames[]"') do (
    if !count! gtr 0 (
        echo.
    )
    echo %%A
    set /a "count+=1"
)


@echo off

setlocal enabledelayedexpansion

for /f "delims=" %%A in (glue_job_names.txt) do (
    set "job_name=%%A"
    for /f "delims=" %%B in ('aws glue get-job --job-name "!job_name!" --query "Job.Command.ScriptLocation" --output text') do (
        echo Job Name: !job_name!, Script Location: %%B
    )
)


import boto3

# Initialize Glue client
glue_client = boto3.client('glue')

# Retrieve all Glue jobs
all_jobs = []
next_token = None

while True:
    if next_token:
        response = glue_client.get_jobs(NextToken=next_token)
    else:
        response = glue_client.get_jobs()

    all_jobs.extend(response['Jobs'])
    next_token = response.get('NextToken')

    if not next_token:
        break

# Print job names and script locations
for job in all_jobs:
    job_name = job['Name']
    script_location = job['Command']['ScriptLocation']
    print(f"Job Name: {job_name}, Script Location: {script_location}")




response = s3.list_objects_v2(Bucket=bucket_name, Prefix=prefix)

# Iterate through the objects
for obj in response.get('Contents', []):
    # Check if the object is a .py file
    if obj['Key'].endswith('.py'):
        # Download the .py file
        file_contents = s3.get_object(Bucket=bucket_name, Key=obj['Key'])['Body'].read().decode('utf-8')
        
        # Check if the file contains the desired line
        if 'xlsx' in file_contents:
            print(f"File {obj['Key']} contains 'xlsx'")
