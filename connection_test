import boto3
import json

# Initialize the Glue client
glue_client = boto3.client('glue')

# Load connection configurations from the JSON file
with open('connections.json') as json_file:
    connections_data = json.load(json_file)

# Loop through each database.table object and test connections
for table_key, table_info in connections_data.items():
    if table_key != "env":
        try:
            connection_name = table_info['conn_name']

            # Test the connection validity
            glue_client.test_connection(Name=connection_name)
            print(f"Connection '{connection_name}' for {table_key} is valid.")
        except glue_client.exceptions.InvalidInputException as e:
            print(f"Connection '{connection_name}' for {table_key} is invalid: {e}")
        except Exception as e:
            print(f"An error occurred while testing connection '{connection_name}' for {table_key}: {e}")
